// mainwindow.cpp
#include "mainwindow.h"
#include "ui_mainwindow.h"
#include <QVBoxLayout>
#include <QHBoxLayout>
#include <QPixmap>
#include <QFont>
#include <QScrollArea>

MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    ui->setupUi(this);
    inicializarInterface();
    inicializarRegiones();
    configurarEstilos();
}

void MainWindow::inicializarInterface()
{
    setWindowTitle("Recursos H√≠dricos del Per√∫");
    setMinimumSize(1200, 800);

    // Widget central con layout horizontal
    QWidget *centralWidget = new QWidget(this);
    QHBoxLayout *mainLayout = new QHBoxLayout(centralWidget);
    setCentralWidget(centralWidget);

    // Panel izquierdo para el mapa
    QWidget *leftPanel = new QWidget;
    QVBoxLayout *leftLayout = new QVBoxLayout(leftPanel);

    // Mapa
    ui->labelMapa = new QLabel;
    QPixmap mapa(":/imagenes/mapa_peru.png");
    ui->labelMapa->setPixmap(mapa.scaled(700, 900, Qt::KeepAspectRatio, Qt::SmoothTransformation));
    ui->labelMapa->setStyleSheet("QLabel { border: 3px solid #34495e; border-radius: 15px; padding: 10px; background-color: white; }");
    leftLayout->addWidget(ui->labelMapa);

    // Panel derecho
    QWidget *rightPanel = new QWidget;
    QVBoxLayout *rightLayout = new QVBoxLayout(rightPanel);

    // T√≠tulo principal
    QLabel *titulo = new QLabel("Recursos H√≠dricos del Per√∫");
    titulo->setStyleSheet(
        "QLabel { "
        "   color: #2c3e50; "
        "   font-size: 28px; "
        "   font-weight: bold; "
        "   padding: 10px; "
        "   border-bottom: 2px solid #3498db; "
        "   margin-bottom: 15px; "
        "}"
        );
    titulo->setAlignment(Qt::AlignCenter);
    rightLayout->addWidget(titulo);

    // Botones de navegaci√≥n
    QHBoxLayout *buttonLayout = new QHBoxLayout;

    QPushButton *btnMapa = new QPushButton("Informaci√≥n");
    QPushButton *btnLeyenda = new QPushButton("Leyenda");
    QPushButton *btnAyuda = new QPushButton("Ayuda");

    btnMapa->setCursor(Qt::PointingHandCursor);
    btnLeyenda->setCursor(Qt::PointingHandCursor);
    btnAyuda->setCursor(Qt::PointingHandCursor);

    connect(btnMapa, &QPushButton::clicked, this, &MainWindow::mostrarMapa);
    connect(btnLeyenda, &QPushButton::clicked, this, &MainWindow::mostrarLeyenda);
    connect(btnAyuda, &QPushButton::clicked, this, &MainWindow::mostrarAyuda);

    buttonLayout->addWidget(btnMapa);
    buttonLayout->addWidget(btnLeyenda);
    buttonLayout->addWidget(btnAyuda);
    rightLayout->addLayout(buttonLayout);

    // StackedWidget para cambiar contenido
    stackedWidget = new QStackedWidget;

    // Crear p√°ginas
    crearPaginaInfo();
    crearPaginaLeyenda();
    crearPaginaAyuda();

    rightLayout->addWidget(stackedWidget);

    // Configurar layout principal
    mainLayout->addWidget(leftPanel, 3);
    mainLayout->addWidget(rightPanel, 2);
}

void MainWindow::crearPaginaInfo()
{
    paginaInfo = new QWidget;
    QVBoxLayout *layout = new QVBoxLayout(paginaInfo);

    infoBox = new QGroupBox("Informaci√≥n del Recurso");
    QVBoxLayout *infoLayout = new QVBoxLayout(infoBox);

    labelInfo = new QLabel("Seleccione un departamento en el mapa");
    labelInfo->setWordWrap(true);
    labelInfo->setStyleSheet(
        "QLabel { "
        "   font-size: 16px; "
        "   line-height: 1.6; "
        "   color: #2c3e50; "
        "   padding: 10px; "
        "}"
        );

    infoLayout->addWidget(labelInfo);
    layout->addWidget(infoBox);

    stackedWidget->addWidget(paginaInfo);
}

void MainWindow::crearPaginaLeyenda()
{
    paginaLeyenda = new QWidget;
    QVBoxLayout *layout = new QVBoxLayout(paginaLeyenda);

    QScrollArea *scrollArea = new QScrollArea;
    QWidget *contenido = new QWidget;
    QVBoxLayout *contenidoLayout = new QVBoxLayout(contenido);

    QString estiloSeccion =
        "QLabel { "
        "   font-size: 20px; "
        "   font-weight: bold; "
        "   color: #ffffff; "
        "   padding: 10px; "
        "   border-bottom: 2px solid #3498db; "
        "   margin-top: 15px; "
        "}";

    QString estiloItem =
        "QLabel { "
        "   font-size: 16px; "
        "   color: #ffffff; "
        "   padding: 5px 15px; "
        "   line-height: 1.4; "
        "}";

    // Cuencas actualizadas
    QLabel *tituloCuencas = new QLabel("üåä Cuencas Principales");
    tituloCuencas->setStyleSheet(estiloSeccion);
    contenidoLayout->addWidget(tituloCuencas);

    QLabel *cuencas = new QLabel(
        "‚Ä¢ Cuenca del Vilcanota-Urubamba (Cusco)\n"
        "‚Ä¢ Cuenca Amaz√≥nica (Loreto)\n"
        "‚Ä¢ Cuenca del R√≠mac (Lima)\n"
        "‚Ä¢ Cuenca del Titicaca (Puno)"
        );
    cuencas->setStyleSheet(estiloItem);
    contenidoLayout->addWidget(cuencas);

    // Represas actualizadas
    QLabel *tituloRepresas = new QLabel("üíß Represas Importantes");
    tituloRepresas->setStyleSheet(estiloSeccion);
    contenidoLayout->addWidget(tituloRepresas);

    QLabel *represas = new QLabel(
        "‚Ä¢ Represa Gallito Ciego (Cajamarca)\n"
        "‚Ä¢ Represa Condoroma (Arequipa)\n"
        "‚Ä¢ Represa Poechos (Piura)\n"
        "‚Ä¢ Represa Lagunillas (Puno)"
        );
    represas->setStyleSheet(estiloItem);
    contenidoLayout->addWidget(represas);

    // Canales actualizados
    QLabel *tituloCanales = new QLabel("‚û°Ô∏è Canales Principales");
    tituloCanales->setStyleSheet(estiloSeccion);
    contenidoLayout->addWidget(tituloCanales);

    QLabel *canales = new QLabel(
        "‚Ä¢ Canal Miguel Checa (Piura)\n"
        "‚Ä¢ Canal CHAVIMOCHIC (La Libertad)\n"
        "‚Ä¢ Canal Chotano (Cajamarca)\n"
        "‚Ä¢ Canal Huachipa (Lima)"
        );
    canales->setStyleSheet(estiloItem);
    contenidoLayout->addWidget(canales);

    scrollArea->setWidget(contenido);
    scrollArea->setWidgetResizable(true);
    scrollArea->setStyleSheet("QScrollArea { border: none; }");
    layout->addWidget(scrollArea);

    stackedWidget->addWidget(paginaLeyenda);
}

void MainWindow::crearPaginaAyuda()
{
    paginaAyuda = new QWidget;
    QVBoxLayout *layout = new QVBoxLayout(paginaAyuda);

    QLabel *tituloAyuda = new QLabel("Gu√≠a de Uso");
    tituloAyuda->setStyleSheet(
        "QLabel { "
        "   font-size: 24px; "
        "   font-weight: bold; "
        "   color: #000000; "
        "   padding: 10px; "
        "   border-bottom: 2px solid #3498db; "
        "}"
        );
    layout->addWidget(tituloAyuda);

    QLabel *instrucciones = new QLabel(
        "1. Navegaci√≥n por el Mapa:\n"
        "   ‚Ä¢ Haga clic en cualquier departamento del mapa para ver sus recursos h√≠dricos\n"
        "   ‚Ä¢ La informaci√≥n se mostrar√° en el panel derecho\n\n"
        "2. Uso de los Botones:\n"
        "   ‚Ä¢ Informaci√≥n: Vuelve a la vista principal\n"
        "   ‚Ä¢ Leyenda: Muestra todos los recursos disponibles\n"
        "   ‚Ä¢ Ayuda: Muestra esta gu√≠a de uso\n\n"
        "3. Tipos de Recursos:\n"
        "   ‚Ä¢ Cuencas: Principales fuentes de agua\n"
        "   ‚Ä¢ Represas: Almacenamiento y control de agua\n"
        "   ‚Ä¢ Canales: Distribuci√≥n y riego"
        );
    instrucciones->setStyleSheet(
        "QLabel { "
        "   font-size: 18px; "
        "   color: #000000; "
        "   padding: 20px; "
        "   padding: 10px; "
        "   line-height: 1.6; "
        "   border-bottom: 2px solid #3498db; "
        "}"
        );
    instrucciones->setWordWrap(true);
    layout->addWidget(instrucciones);

    stackedWidget->addWidget(paginaAyuda);
}

void MainWindow::configurarEstilos()
{
    setStyleSheet(
        "QMainWindow { "
        "   background-color: #ecf0f1; "
        "}"
        "QPushButton { "
        "   background-color: #3498db; "
        "   color: white; "
        "   border: none; "
        "   padding: 10px 20px; "
        "   border-radius: 5px; "
        "   font-size: 16px; "
        "   font-weight: bold; "
        "   min-width: 120px; "
        "}"
        "QPushButton:hover { "
        "   background-color: #2980b9; "
        "}"
        "QPushButton:pressed { "
        "   background-color: #2473a6; "
        "}"
        "QGroupBox { "
        "   background-color: white; "
        "   border-radius: 10px; "
        "   padding: 15px; "
        "   font-size: 18px; "
        "   font-weight: bold; "
        "   color: #2c3e50; "
        "   border: 2px solid #bdc3c7; "
        "}"
        "QScrollArea { "
        "   background-color: white; "
        "   border-radius: 10px; "
        "}"
        );
}

void MainWindow::inicializarRegiones()
{
    // Coordenadas actualizadas para mejor precisi√≥n
    regionesMapa = {
        {"Cusco", QRect(400, 480, 80, 60)}, //
        {"Puno", QRect(530, 580, 80, 60)}, //
        {"Loreto", QRect(230, 80, 180, 140)}, //
        {"Piura", QRect(80, 180, 80, 60)},//
        {"Lima", QRect(230, 480, 70, 60)},//
        {"La Libertad", QRect(110, 280, 80, 60)}, //
        {"Cajamarca", QRect(100, 130, 80, 60)}, //
        {"Arequipa", QRect(430, 630, 120, 80)} //
    };

    // Estructura de datos modificada para manejar m√∫ltiples recursos por departamento
    recursosHidricos = {
        {"Cusco", {
                      {"CUENCA DEL VILCANOTA-URUBAMBA",
                       "Extensi√≥n: 58,735 km¬≤\n"
                       "Principales afluentes: R√≠o Vilcanota, R√≠o Urubamba\n"
                       "Uso principal: Agr√≠cola y generaci√≥n el√©ctrica\n"
                       "Poblaci√≥n beneficiada: M√°s de 1 mill√≥n de habitantes"}
                  }},

        {"Loreto", {
                       {"CUENCA AMAZ√ìNICA",
                        "Extensi√≥n: 950,000 km¬≤\n"
                        "Principales r√≠os: Amazonas, Mara√±√≥n, Ucayali\n"
                        "Navegabilidad: 365 d√≠as al a√±o\n"
                        "Importancia: Principal fuente h√≠drica del pa√≠s"}
                   }},

        {"Lima", {
                     {"CUENCA DEL R√çMAC",
                      "Extensi√≥n: 3,503 km¬≤\n"
                      "Caudal promedio: 31.5 m¬≥/s\n"
                      "Uso principal: Abastecimiento poblacional\n"
                      "Beneficiarios: 10 millones de habitantes"},
                     {"CANAL HUACHIPA",
                      "Longitud: 27.1 km\n"
                      "Capacidad: 10 m¬≥/s\n"
                      "√Årea beneficiada: 25,000 hect√°reas\n"
                      "Uso principal: Agua potable y riego"}
                 }},

        {"Puno", {
                     {"CUENCA DEL TITICACA",
                      "Extensi√≥n: 56,270 km¬≤\n"
                      "Altitud: 3,812 msnm\n"
                      "Profundidad m√°xima: 281 m\n"
                      "Importancia: Mayor lago navegable de Sudam√©rica"},
                     {"REPRESA LAGUNILLAS",
                      "Capacidad: 585 millones de m¬≥\n"
                      "Altura: 108 metros\n"
                      "√Årea irrigada: 28,000 hect√°reas\n"
                      "Uso principal: Riego y energ√≠a"}
                 }},

        {"Arequipa", {
                         {"REPRESA DE CONDOROMA",
                          "Capacidad: 285 millones de m¬≥\n"
                          "Altura: 85 metros\n"
                          "Uso: Riego y energ√≠a\n"
                          "Beneficia: Valle de Majes y Siguas"}
                     }},

        {"Cajamarca", {
                          {"REPRESA GALLITO CIEGO",
                           "Capacidad: 573 millones de m¬≥\n"
                           "Altura: 105 metros\n"
                           "√Årea de embalse: 14.5 km¬≤\n"
                           "Beneficia: Valle Jequetepeque"},
                          {"CANAL CHOTANO",
                           "Longitud: 44.5 km\n"
                           "Capacidad: 13 m¬≥/s\n"
                           "√Årea irrigada: 30,000 hect√°reas\n"
                           "Cultivos: Arroz y ca√±a de az√∫car"}
                      }},

        {"Piura", {
                      {"CANAL MIGUEL CHECA",
                       "Longitud: 79 km\n"
                       "Capacidad: 19 m¬≥/s\n"
                       "√Årea irrigada: 45,000 hect√°reas\n"
                       "Cultivos principales: Arroz, algod√≥n, ma√≠z"},
                      {"REPRESA POECHOS",
                       "Capacidad: 1,000 millones de m¬≥\n"
                       "Altura: 48 metros\n"
                       "√Årea irrigada: 150,000 hect√°reas\n"
                       "Beneficiarios: 200,000 habitantes"}
                  }},

        {"La Libertad", {
                            {"CANAL CHAVIMOCHIC",
                             "Longitud: 154 km\n"
                             "Capacidad: 85 m¬≥/s\n"
                             "√Årea beneficiada: 144,385 hect√°reas\n"
                             "Beneficiarios: 150,000 habitantes"}
                        }}
    };
}

void MainWindow::mousePressEvent(QMouseEvent *event)
{
    QPoint pos = ui->labelMapa->mapFrom(this, event->pos());

    for (auto it = regionesMapa.begin(); it != regionesMapa.end(); ++it) {
        if (it.value().contains(pos)) {
            mostrarInformacionRecurso(it.key());
            break;
        }
    }
}

void MainWindow::mostrarInformacionRecurso(const QString &departamento)
{
    if (recursosHidricos.contains(departamento)) {
        stackedWidget->setCurrentWidget(paginaInfo);

        // Construir el texto combinado para todos los recursos del departamento
        QString infoCompleta;
        const auto &recursos = recursosHidricos[departamento];

        for (auto it = recursos.begin(); it != recursos.end(); ++it) {
            if (it != recursos.begin()) {
                infoCompleta += "\n\n" + QString(40, '-') + "\n\n";  // Separador entre recursos
            }
            infoCompleta += it.key() + "\n\n" + it.value();
        }

        labelInfo->setText(infoCompleta);
        infoBox->setTitle("Recursos H√≠dricos de " + departamento);

        // Ajustar el estilo para mejor legibilidad
        labelInfo->setStyleSheet(
            "QLabel { "
            "   font-size: 16px; "
            "   line-height: 1.6; "
            "   color: #2c3e50; "
            "   padding: 10px; "
            "   background-color: #f8f9fa; "
            "   border-radius: 5px; "
            "}"
            );
    }
}

void MainWindow::mostrarLeyenda()
{
    stackedWidget->setCurrentWidget(paginaLeyenda);
}

void MainWindow::mostrarAyuda()
{
    stackedWidget->setCurrentWidget(paginaAyuda);
}

void MainWindow::mostrarMapa()
{
    stackedWidget->setCurrentWidget(paginaInfo);
}

MainWindow::~MainWindow()
{
    delete ui;
}
